
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>Task3 vxlan jinja2 - Cisco Live 2023 LTRDCN-2765</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-1-install-jinja2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cisco Live 2023 LTRDCN-2765" class="md-header__button md-logo" aria-label="Cisco Live 2023 LTRDCN-2765" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cisco Live 2023 LTRDCN-2765
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task3 vxlan jinja2
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ciscolivelab/LTRDCN-2765" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../intro/" class="md-tabs__link">
      Introduction
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../Task1-ansible-node0/" class="md-tabs__link">
      Task 1 - Prepare Ansible node
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task2-first-ansible/" class="md-tabs__link">
      Task 2 - First Simple Ansible Playbook
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task3-vxlan-jinja2-new/" class="md-tabs__link">
      Task 3 - Use of Jinja2 templates with Ansible Playbook
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task4-vxlan-nxos/" class="md-tabs__link">
      Task 4 - Config switches using Ansible NXOS modules
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task5-day2-pipeline0/" class="md-tabs__link">
      Task 5 - Day 2 Opertions with CI Pipeline
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cisco Live 2023 LTRDCN-2765" class="md-nav__button md-logo" aria-label="Cisco Live 2023 LTRDCN-2765" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cisco Live 2023 LTRDCN-2765
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ciscolivelab/LTRDCN-2765" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task1-ansible-node0/" class="md-nav__link">
        Task 1 - Prepare Ansible node
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task2-first-ansible/" class="md-nav__link">
        Task 2 - First Simple Ansible Playbook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task3-vxlan-jinja2-new/" class="md-nav__link">
        Task 3 - Use of Jinja2 templates with Ansible Playbook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task4-vxlan-nxos/" class="md-nav__link">
        Task 4 - Config switches using Ansible NXOS modules
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task5-day2-pipeline0/" class="md-nav__link">
        Task 5 - Day 2 Opertions with CI Pipeline
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-install-jinja2" class="md-nav__link">
    Step 1: Install jinja2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-playbook-for-jinja2-spine" class="md-nav__link">
    Step 2: Playbook for jinja2 Spine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-create-new-roles-and-vars" class="md-nav__link">
    Step 3: Create new roles and vars
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-create-variable-file-for-jina2_spine-role" class="md-nav__link">
    Step 4: Create variable file for “jina2_spine” role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-create-jinja2-template-for-spine-role" class="md-nav__link">
    Step 5: Create Jinja2 template for spine role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-create-playbook-for-jinja2_spine-role" class="md-nav__link">
    Step 6: Create playbook for jinja2_spine role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-run-jinja2_fabric-playbook" class="md-nav__link">
    Step 7: Run Jinja2_fabric playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-8-modify-playbook-for-leaf" class="md-nav__link">
    Step 8: Modify playbook for Leaf
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-9-variable-file-for-jinja2_leaf-role" class="md-nav__link">
    Step 9: Variable file for jinja2_leaf role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-10-jinja2-template-for-leaf-role" class="md-nav__link">
    Step 10: Jinja2 template for leaf role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-11-create-playbook-for-jinja2_leaf-role" class="md-nav__link">
    Step 11: Create playbook for jinja2_leaf role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-12-run-jinja2_fabric-playbook" class="md-nav__link">
    Step 12: Run Jinja2_fabric playbook
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Task3 vxlan jinja2</h1>

<p>In this task, we are going to install Jinja2 - that provides templating option.  In this section, we use Jinja2 to create template for spine and leaf and configure VXLAN fabric using this Jinja2 templates.</p>
<p><img alt="" src="../pic/3-0-1-new.png" /></p>
<p>Jinja2 template looks just like the NXOS configurations. We abstract the variables out of the configuration and use simple for loop to feed variables into the template.</p>
<hr />
<h3 id="step-1-install-jinja2">Step 1: Install jinja2</h3>
<ul>
<li>On the Ansible node, install jinja2 using <code>pip install jinja2</code> command.  If it is already installed, we will get the message “requirement is satisfied”:
<div class="highlight"><pre><span></span><code>        root@ubuntu:~# pip install jinja2
</code></pre></div></li>
</ul>
<p>Below screenshot shows the output of above command:</p>
<p><img alt="" src="../pic/3-1-1-new.png" /></p>
<hr />
<h3 id="step-2-playbook-for-jinja2-spine">Step 2: Playbook for jinja2 Spine</h3>
<p>In this section, we will use Jina2 template and Ansible to provision the VXLAN Fabric.</p>
<ul>
<li>
<p>Switch to “Atom”, <strong>right click</strong> on the folder <code>EVPN-Ansible</code> and Click <code>New File</code> to create a new playbook named <code>jinja2_fabric.yml</code>.</p>
<p><img alt="" src="../pic/3-2-1.png" /></p>
</li>
<li>
<p>Name the new file <code>jinja2_fabric.yml</code> and hit enter as shown below. It will create this new file:</p>
</li>
</ul>
<p><img alt="" src="../pic/3-2-1a.png" /></p>
<ul>
<li>
<p>Also, on the lower bar of the ATOM, verify that  file grammar of <strong>YAML</strong> is selected instead of default "<strong>Plain Text</strong>".  If <strong>YAML</strong> is not selected, then you should <strong>choose</strong> it from the listed options.</p>
</li>
<li>
<p>Now enter below data in this playbook:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jinja2_spine</span>
<span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jinja2_spine</span>
</code></pre></div>
<ul>
<li>
<p>The contents of the <strong>jinja2_fabric.yml</strong> file should look like</p>
<p><img alt="" src="../pic/3-2-2-new.png" /></p>
</li>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package</p>
</li>
<li>
<p>On the MTputty, go back to the <strong>ssh</strong> session to Ansible Server node (198.18.134.150).</p>
</li>
<li>
<p>On Ansible server node (198.18.134.150), <strong>verify</strong> that the (below highlighted) 2 groups exists of <em>jinja2_spine</em> and <em>jinja2_leaf</em> in the inventory file named "<strong>hosts</strong>" (under EVPN-Ansible directory) exists by issuing below commands:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>root@ubuntu:~# cd /root/EVPN-Ansible
root@ubuntu:~/EVPN-Ansible# more hosts
</code></pre></div>
<p>Below screenshot confirms the ouptut and appropriate IP addresses of above command:</p>
<p><img alt="" src="../pic/3-2-3.png" /></p>
<hr />
<h3 id="step-3-create-new-roles-and-vars">Step 3: Create new roles and vars</h3>
<p>In this section, we will create two new roles for provisioning Fabric with Jina2 template.</p>
<ul>
<li>
<p>On the MTputty, go back to Ansible Server node (198.18.134.150), switch to ‘<strong>roles</strong>’ directory; <strong>create</strong> ‘jinja2_spine’ and ‘jinja2_leaf’ roles using ansible-galaxy using below commands:</p>
<pre><code>root@ubuntu:~# cd ~/EVPN-Ansible/
root@ubuntu:~/EVPN-Ansible# cd roles/
root@ubuntu:~/EVPN-Ansible/roles# ansible-galaxy init jinja2_spine&amp;&amp;ansible-galaxy init jinja2_leaf
</code></pre>
</li>
<li>
<p>Below screenshot shows the output of above command:</p>
</li>
</ul>
<p><img alt="" src="../pic/3-3-1.png" /></p>
<p><em>Note:</em> ‘<strong>ansible-galaxy</strong>’ will initialize the role structure and create necessary folders with default name like ‘tasks’, ‘template’, ‘vars’ etc.</p>
<ul>
<li>
<p><strong>change directory</strong> path to EVPN-Ansible/roles/jinja2_spine and check the content of local directory (<code>ls</code>) as per below commands:</p>
<pre><code>root@ubuntu:~# cd ~/EVPN-Ansible/roles/jinja2_spine/
root@ubuntu:~/EVPN-Ansible/roles/jinja2_spine# ls
</code></pre>
</li>
<li>
<p>Below screenshot shows the output of above file.  Note that various directories including tasks, templates, vars exists.  We will use these in later steps.</p>
<p><img alt="" src="../pic/3-3-2.png" /></p>
</li>
</ul>
<p>Next:</p>
<ul>
<li>
<p><strong>Create</strong> empty jinja2 template files for spine and leaf under templates folder for each role by running below commands:</p>
<pre><code>root@ubuntu:~/EVPN-Ansible/roles# cd ~/EVPN-Ansible/roles
root@ubuntu:~/EVPN-Ansible/roles# touch jinja2_spine/templates/spine.j2
root@ubuntu:~/EVPN-Ansible/roles# touch jinja2_leaf/templates/leaf.j2
</code></pre>
</li>
<li>
<p>Switch to “<strong>Atom</strong>” and sync the new created folders between Ansible node and Remote desktop by pressing <strong>Right Click</strong> on the folder <code>EVPN-Ansible</code>, then open <code>Remote Sync</code> select <code>Download Folder</code> as shown below:</p>
</li>
</ul>
<p><img alt="" src="../pic/3-3-3.png" /></p>
<ul>
<li>Once the download is done you should see the new folder &amp; files (<code>roles</code>) appear on ATOM as well.</li>
</ul>
<hr />
<h3 id="step-4-create-variable-file-for-jina2_spine-role">Step 4: Create variable file for “jina2_spine” role</h3>
<p>“<strong>ansible-galaxy</strong>” automatically creates empty “<strong>main.yml</strong>” file under “<strong>vars</strong>” folder. We can use “<strong>Atom</strong>” to edit the main.yml file to include the following variables that will be used in jinja2 template.</p>
<ul>
<li>
<p>Switch to <strong>ATOM</strong>, then open up the project folder <code>EVPN-Ansible</code> from the left pane and <strong>open</strong> <code>main.yml</code> file under “<strong>roles/jinja2_spine/vars/</strong>” as shown below:</p>
<p><img alt="" src="../pic/3-4-1.png" /></p>
</li>
<li>
<p>use “<strong>Atom</strong>” to edit the “<strong>main.yml</strong>” file to include the following variables that will be used in jinja2 template.  You can copy and paste all of the below content into main.yml file.  Note: as per steps in previous tasks, be careful with YAML content since its space sensitive.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># vars file for jinja2_spine</span>
<span class="w">  </span><span class="nt">asn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65000</span>
<span class="w">  </span><span class="nt">bgp_neighbors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">remote_as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65000</span>
<span class="w">     </span><span class="nt">neighbor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.8</span>
<span class="w">     </span><span class="nt">update_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Loopback0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">remote_as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65000</span>
<span class="w">     </span><span class="nt">neighbor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.10</span>
<span class="w">     </span><span class="nt">update_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Loopback0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">remote_as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65000</span>
<span class="w">     </span><span class="nt">neighbor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.11</span>
<span class="w">     </span><span class="nt">update_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Loopback0</span>
<span class="w">  </span><span class="nt">L3_interfaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ethernet 1/1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ethernet 1/2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ethernet 1/3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ethernet 1/4</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loopback 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loopback 1</span>
<span class="w">  </span><span class="nt">s1_loopback</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.6</span>
<span class="w">  </span><span class="nt">s2_loopback</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.7</span>
</code></pre></div>
<ul>
<li>
<p>Contents of the ‘<strong>main.yml</strong>’ file should look like below:</p>
<p><img alt="" src="../pic/3-4-2.png" /></p>
</li>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</p>
</li>
</ul>
<hr />
<h3 id="step-5-create-jinja2-template-for-spine-role">Step 5: Create Jinja2 template for spine role</h3>
<ul>
<li>On <strong>ATOM</strong> open up the project folder <code>EVPN-Ansible</code> from the left pane and <strong>open</strong> <code>spine.j2</code> file under “<strong>roles/jinja2_spine/templates</strong>” as shown below:</li>
</ul>
<p><img alt="" src="../pic/3-5-0.png" /></p>
<p><strong>NOTE: If the file does not appear on the ATOM, then go ahead and execute below 4 steps to get it sync.  If the <code>spine.j2</code> file appears in above folder then you can skip below 4 steps</strong>:</p>
<ol>
<li>
<p>On Ansible server (198.18.134.150) using your SSH session, change Directory to folder EVPN-Ansible using below command:</p>
<pre><code>root@ubuntu:~# cd ~/EVPN-Ansible/
</code></pre>
</li>
<li>
<p>further, change Directory (cd) to folder roles/jinja2_spine/templates using below command:</p>
<pre><code>root@ubuntu:~/EVPN-Ansible# cd roles/jinja2_spine/templates/
</code></pre>
</li>
<li>
<p>Type <code>touch spine.j2</code> as shown below:</p>
<pre><code>root@ubuntu:~/EVPN-Ansible/roles/jinja2_spine/templates# touch spine.j2
</code></pre>
</li>
<li>
<p>After entering the command, go back to ATOM,  <strong>right click</strong> on folder <code>EVPN-Ansible</code>, scroll to choose option <code>Remote Sync</code> option and choose <code>Download Folder</code> as shown below:</p>
</li>
</ol>
<p><img alt="" src="../pic/3-5-1.png" /></p>
<p>Now that the file/folder appears properly on ATOM, go ahead and proceed with further steps:</p>
<ul>
<li>
<p>To reduce the typo, you can move (or copy) <strong>spine.j2</strong> file from local <strong>playbook</strong> folder</p>
<p><code>TFTP_Data (\\AD1) (X:)</code> --&gt;  <code>playbook</code> --&gt; <code>roles</code> --&gt; <code>jinja2_spine</code> --&gt; `templates``</p>
</li>
</ul>
<p>and paste the file in the projects folder</p>
<pre><code>`TFTP_Data (\\AD1) (X:)` --&gt;  `EVPN-Ansible` --&gt; `roles` --&gt; `jinja2_spine` --&gt; `templates`
</code></pre>
<p>as shown below:</p>
<p><img alt="" src="../pic/3-5-3.png" /></p>
<ul>
<li>
<p>After moving/copying this file to above folder location, open this file on ATOM.  You do this by going to <code>File</code> then <code>Open File…</code> on ATOM, and browse to this <code>spine.j2</code> file that was just saved in <code>X:\EVPN-Ansible\roles\jinja2_spine\templates</code> as shown below:
    <img alt="" src="../pic/3-5-4.png" /></p>
</li>
<li>
<p>After opening “<strong>spine.j2</strong>” file from ATOM (as shown in below screenshot confirming the updated content), go to <code>File</code> –-&gt; <code>Save</code> to push template file to Ansible node:</p>
<p><img alt="" src="../pic/3-5-5.png" /></p>
</li>
<li>
<p>You can verify that updated file content is on Ansible server (198.18.134.150) using your SSH session by issuing below commands:
<div class="highlight"><pre><span></span><code>root@ubuntu:~/EVPN-Ansible/roles/jinja2_spine/templates# cd /root/EVPN-Ansible/roles/jinja2_spine/templates
root@ubuntu:~/EVPN-Ansible/roles/jinja2_spine/templates# more spine.j2
</code></pre></div></p>
</li>
</ul>
<p>Partial output of above command is shown in below screenshot confirming :
  <img alt="" src="../pic/3-5-6.png" /></p>
<hr />
<h3 id="step-6-create-playbook-for-jinja2_spine-role">Step 6: Create playbook for jinja2_spine role</h3>
<p>The playbook for jinja2_spine roles has two tasks. First task uses ansible <strong>template</strong> module to generate configuration file based on jinja2 template created in last step. The configuration file is saved in “<strong>file</strong>” folder. Second task is push the configuration to switch.</p>
<p>“<strong>ansible-galaxy</strong>” automatically creates empty “<strong>main.yml</strong>” file under “<strong>tasks</strong>” folder.  We are going to use “<strong>Atom</strong>” to edit the <strong>main.yml</strong> file.</p>
<ul>
<li>On ATOM, open up the project folder <code>EVPN-Ansible</code> and edit <code>main.yml</code> file under <code>roles/jinja2_spine/tasks/</code> to include following:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># tasks file for jinja2_spine</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Spine Config</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=spine.j2 dest=roles/jinja2_spine/files/{{inventory_hostname}}.cfg</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Push Spine Config</span>
<span class="w">    </span><span class="nt">cisco.nxos.nxos_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">roles/jinja2_spine/files/{{inventory_hostname}}.cfg</span>
<span class="w">      </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
</code></pre></div>
<ul>
<li>
<p>Contents of the ‘<strong>main.yml</strong>’ file should look like below:</p>
<p><img alt="" src="../pic/3-6-1.png" /></p>
</li>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</p>
</li>
</ul>
<p><strong>NOTE:</strong> In the above YAML file, ansible module named “<strong>cisco.nxos.nxos_config</strong>” is used.  This module performs below activities:</p>
<ul>
<li>It uses source path of the file (“<strong><em>src</em></strong>”) that contains the configuration or configuration template to load into spine</li>
<li>Since “<strong><em>match</em></strong>” option is set to none (yes), hence the module will not attempt to compare the source configuration with the running configuration on the remote device.</li>
</ul>
<hr />
<h3 id="step-7-run-jinja2_fabric-playbook">Step 7: Run Jinja2_fabric playbook</h3>
<p>In this section you will run the playbook created in step 2 (in this task 3), this will generate configuration file for Spine-2 switch from the template.</p>
<p>The playbook will also push the configuration file to Spine-2 switches.</p>
<ul>
<li>
<p>Run the ansible playbook by going to folder EVPN-Ansible and executing the below commands:</p>
<pre><code>root@ubuntu:~/EVPN-Ansible/roles# cd ~/EVPN-Ansible/
root@ubuntu:~/EVPN-Ansible# ansible-playbook jinja2_fabric.yml
</code></pre>
<p><strong>Note: It will take few minutes to push configuration</strong></p>
<p>Below screenshot shows the execution of above playbook:</p>
<p><img alt="" src="../pic/3-7-1.png" /></p>
</li>
</ul>
<p>To verify the execution of this playbook, you can:</p>
<ul>
<li>
<p><strong>Login</strong> to <strong>Spine-2 </strong>switch (<strong>on MTputty</strong>) to verify configuration has been pushed by double clicking the spine-2 icon in the left pane on MTputty.  If prompted then login with credentials admin/C1sco12345</p>
</li>
<li>
<p>Execute <code>show run bgp</code> command on the switch to confirm the configurations have been provisioned (as shown below):</p>
<p><img alt="" src="../pic/3-7-2-new.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-8-modify-playbook-for-leaf">Step 8: Modify playbook for Leaf</h3>
<p>In this section, we will use Jina2 template and Ansible to provision the VXLAN Fabric on leaf-4.   We are going to add jinja2_leaf this time to the already created playbook in step 2.</p>
<ul>
<li>Switch to “<strong>Atom</strong>”, click on the folder <code>EVPN-Ansible</code>, edit the existing playbook <code>jinja2_fabric.yml</code> file for a role for leaf (named jinja2_leaf).  Add the below content at the end of existing file (i.e., add the below content to existing content in this file (do not overwrite existing content):</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jinja2_leaf</span>
<span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jinja2_leaf</span>
</code></pre></div>
<ul>
<li>Below screenshot shows the contents of <strong>jinja2_fabric.yml</strong> file in Atom after adding the above configs:</li>
</ul>
<p><img alt="" src="../pic/3-8-1.png" /></p>
<ul>
<li><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</li>
</ul>
<hr />
<h3 id="step-9-variable-file-for-jinja2_leaf-role">Step 9: Variable file for jinja2_leaf role</h3>
<ul>
<li>On ATOM, open up the project folder <code>EVPN-Ansible</code> and edit <code>main.yml</code> file under <code>roles/jinja2_leaf/vars/</code> to include following:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># vars file for jinja2_leaf</span>
<span class="w">  </span><span class="nt">asn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65000</span>
<span class="w">  </span><span class="nt">bgp_neighbors</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">remote_as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65000</span>
<span class="w">     </span><span class="nt">neighbor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.6</span>
<span class="w">     </span><span class="nt">update_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Loopback0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">remote_as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65000</span>
<span class="w">     </span><span class="nt">neighbor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.7</span>
<span class="w">     </span><span class="nt">update_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Loopback0</span>
<span class="w">  </span><span class="nt">rp_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.100</span>
<span class="w">  </span><span class="nt">L3_interfaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ethernet 1/1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ethernet 1/2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loopback 0</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loopback 1</span>
<span class="w">  </span><span class="nt">L2VNI</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">vlan_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">140</span>
<span class="w">     </span><span class="nt">vni</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50140</span>
<span class="w">     </span><span class="nt">ip_add</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.140.1</span>
<span class="w">     </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
<span class="w">     </span><span class="nt">vlan_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L2-VNI-140-Tenant1</span>
<span class="w">     </span><span class="nt">mcast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">239.0.0.140</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">vlan_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">141</span>
<span class="w">     </span><span class="nt">vni</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50141</span>
<span class="w">     </span><span class="nt">ip_add</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.141.1</span>
<span class="w">     </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
<span class="w">     </span><span class="nt">vlan_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L2-VNI-141-Tenant1</span>
<span class="w">     </span><span class="nt">mcast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">239.0.0.141</span>
<span class="w">  </span><span class="nt">L3VNI</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="nt">vlan_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">999</span>
<span class="w">     </span><span class="nt">vlan_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L3-VNI-999-Tenant1</span>
<span class="w">     </span><span class="nt">vni</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50999</span>
</code></pre></div>
<ul>
<li>
<p>Below screenshot shows the contents of jinja2_leaf\vars\main.yml file in Atom:</p>
<p><img alt="" src="../pic/3-9-1.png" /></p>
</li>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</p>
</li>
</ul>
<hr />
<h3 id="step-10-jinja2-template-for-leaf-role">Step 10: Jinja2 template for leaf role</h3>
<ul>
<li>On ATOM, open up the project folder <code>EVPN-Ansible</code> and open <strong>leaf.j2</strong> file under “<strong>roles/jinja2_leaf/templates/</strong>”</li>
</ul>
<p><strong>NOTE: if the file does not appear on the ATOM, then go ahead and execute below 4 steps to get it sync.  If the <code>leaf.j2</code> file appears in above folder then you can skip below 4 steps</strong>:</p>
<ol>
<li>
<p>On MTputty, change Directory to folder EVPN-Ansible on Ansible server (198.18.134.150) using below command:</p>
<p><code>cd ~/EVPN-Ansible</code></p>
</li>
<li>
<p>further, change Directory (cd) to folder roles/jinja2_leaf/templates using below command:</p>
<p><code>cd roles/jinja2_leaf/templates</code></p>
</li>
<li>
<p>Type <code>touch leaf.j2</code></p>
</li>
<li>After entering the command, go back to ATOM,  <strong>right click</strong> on folder <code>EVPN-Ansible</code>, scroll to choose option <code>Remote Sync</code> option and choose <code>Download Folder</code></li>
</ol>
<p>Now that the file/folder appears properly on ATOM, go ahead and proceed with further steps:</p>
<ul>
<li>
<p>To reduce the typo, you can move (or copy) <strong>leaf.j2</strong> file from local <strong>playbook</strong> folder</p>
<p><code>TFTP_Data (\\AD1) (X:)</code> --&gt;  <code>playbook</code> --&gt; <code>roles</code> --&gt; <code>jinja2_leaf</code> --&gt; `templates``</p>
</li>
</ul>
<p>and paste the file in the projects folder</p>
<pre><code>`TFTP_Data (\\AD1) (X:)` --&gt;  `EVPN-Ansible` --&gt; `roles` --&gt; `jinja2_leaf` --&gt; `templates`
</code></pre>
<p>as shown below:</p>
<p><img alt="" src="../pic/3-10-2.png" /></p>
<ul>
<li>
<p>On ATOM, go to <code>File</code> then <code>Open File…</code> and browse to this <code>leaf.j2</code> that was just saved in <code>X:\EVPN-Ansible\roles\jinja2_leaf\templates</code> as shown below screenshot:</p>
<p><img alt="" src="../pic/3-10-4.png" /></p>
</li>
<li>
<p>After opening “<strong>leaf.j2</strong>” file from ATOM, go to <code>File</code> – <code>Save</code> to push template file to Ansible node:</p>
</li>
</ul>
<hr />
<h3 id="step-11-create-playbook-for-jinja2_leaf-role">Step 11: Create playbook for jinja2_leaf role</h3>
<p>The playbook for jinja2_leaf roles has two tasks.</p>
<ol>
<li>First task uses ansible template module to generate configuration file based on jinja2 template created in last step. The configuration file is saved in “file” folder.</li>
<li>Second task is to push the configuration to switch.</li>
</ol>
<p>“<strong>ansible-galaxy</strong>” automatically creates empty “<strong>main.yml</strong>” file under “<strong>tasks</strong>” folder.  We are going to use “<strong>Atom</strong>” to edit this main.yml file.</p>
<ul>
<li>On ATOM, open up the project folder <code>EVPN-Ansible</code> and edit “<strong>main.yml</strong>” file under “<strong>roles/jinja2_leaf/tasks/</strong>” to include following:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># tasks file for jinja2_leaf</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate Leaf Config</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=leaf.j2 dest=roles/jinja2_leaf/files/{{inventory_hostname}}.cfg</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Push Leaf Config</span>
<span class="w">    </span><span class="nt">cisco.nxos.nxos_config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">roles/jinja2_leaf/files/{{inventory_hostname}}.cfg</span>
<span class="w">      </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
</code></pre></div>
<p>Below screenshot shows how the contents of <strong>jinja2_leaf/taks/main.yml</strong> file looks like in Atom:</p>
<p><img alt="" src="../pic/3-11-1.png" /></p>
<hr />
<h3 id="step-12-run-jinja2_fabric-playbook">Step 12: Run Jinja2_fabric playbook</h3>
<p>In this section you will run the playbook created in step 8, this will generate configuration file for Spine-2 and Leaf-4 switches. It will also push the configuration file to both switches.</p>
<ul>
<li>
<p>Before running the ansible-playbook, you may <strong>log</strong> into the leaf-4 (in MTputty SSH session) and verify that no bgp configurations exist by running <code>show running bgp</code> command as shown below:</p>
<p><img alt="" src="../pic/3-12-0.png" /></p>
</li>
</ul>
<p>NOTE: It might take couple of minutes for the configuration to be pushed to via the Ansible Server. It is working in the background.</p>
<ul>
<li>
<p>On the Ansible node (in MTputty SSH session), run the command (<code>ansible-playbook jinja2_fabric.yml</code>) to execute the playbook as shown below:</p>
<pre><code>root@ubuntu:~/EVPN-Ansible# ansible-playbook jinja2_fabric.yml
</code></pre>
<p>Below screenshot shows the output of above command:</p>
<p><img alt="" src="../pic/3-12-1.png" /></p>
</li>
<li>
<p>After the configuration push is successful, <strong>login</strong> (on MTputty SSH session) to <strong>leaf-4</strong> switch to verify configuration has been pushed by running below command:</p>
<pre><code>show running-config bgp
</code></pre>
<p>The output of above command is shown below:</p>
<p><img alt="" src="../pic/3-12-2.png" /></p>
</li>
</ul>
<hr />
<p>Congrats: you have successfully concluded this task by using jinja2 templates with Ansible for Cisco Nexus switches</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.indexes", "navigation.instant", "navigation.top", "search.suggest"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>