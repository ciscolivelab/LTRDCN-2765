
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>Task5 day2 operation - Cisco Live 2023 LTRDCN-2765</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#task-5-day-2-operation-using-ansible" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cisco Live 2023 LTRDCN-2765" class="md-header__button md-logo" aria-label="Cisco Live 2023 LTRDCN-2765" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cisco Live 2023 LTRDCN-2765
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task5 day2 operation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ciscolivelab/LTRDCN-2765" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../intro/" class="md-tabs__link">
      Introduction
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../Task1-ansible-node0/" class="md-tabs__link">
      Task 1 - Prepare Ansible node
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task2-first-ansible/" class="md-tabs__link">
      Task 2 - First Simple Ansible Playbook
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task3-vxlan-jinja2-new/" class="md-tabs__link">
      Task 3 - Use of Jinja2 templates with Ansible Playbook
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task4-vxlan-nxos/" class="md-tabs__link">
      Task 4 - Config switches using Ansible NXOS modules
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../task5-day2-pipeline0/" class="md-tabs__link">
      Task 5 - Day 2 Opertions with CI Pipeline
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cisco Live 2023 LTRDCN-2765" class="md-nav__button md-logo" aria-label="Cisco Live 2023 LTRDCN-2765" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cisco Live 2023 LTRDCN-2765
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ciscolivelab/LTRDCN-2765" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Task1-ansible-node0/" class="md-nav__link">
        Task 1 - Prepare Ansible node
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task2-first-ansible/" class="md-nav__link">
        Task 2 - First Simple Ansible Playbook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task3-vxlan-jinja2-new/" class="md-nav__link">
        Task 3 - Use of Jinja2 templates with Ansible Playbook
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task4-vxlan-nxos/" class="md-nav__link">
        Task 4 - Config switches using Ansible NXOS modules
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../task5-day2-pipeline0/" class="md-nav__link">
        Task 5 - Day 2 Opertions with CI Pipeline
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-backup-running-configurations" class="md-nav__link">
    Step 1: Backup running configurations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-verify-underlay-and-overlay" class="md-nav__link">
    Step 2: Verify underlay and overlay
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-baseline-configuration-comparison" class="md-nav__link">
    Step 3: Baseline configuration comparison
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-add-new-vni" class="md-nav__link">
    Step 4: Add new VNI
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="task-5-day-2-operation-using-ansible">Task 5: Day 2 operation using Ansible</h1>
<p>In this section, we will use automation to perform following day 2 operation tasks.</p>
<ul>
<li>Backup running configurations on all leaf and spine switches</li>
<li>Verify underlay ospf, bgp and pim neighbors</li>
<li>Verify overlay nve peer, host route, bgp update</li>
<li>Baseline configuration comparison</li>
<li>Add new VNIs into the existing fabric</li>
</ul>
<hr />
<h3 id="step-1-backup-running-configurations">Step 1: Backup running configurations</h3>
<p>In this section, you will use <strong>ios_config</strong> module to backup running configuration on each switch, the backup file will be saved to a local <strong>“backup”</strong> folder.  The backup argument create a full backup of the current running-config of each switch.  The backup file is written to the backup folder in the playbook root directory. If the directory does not exist, it is created.</p>
<ul>
<li>
<p>On <strong>Atom</strong>, open up the project folder <strong>“EVPN-Ansible”</strong> and create new file under <code>EVPN-Ansible</code>. Name the new file <code>get_config.yml</code>.</p>
</li>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spine,leaf,jinja2_leaf,jinja2_spine</span>
<span class="w">     </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">save running</span>
<span class="w">        </span><span class="nt">cisco.nxos.nxos_config</span><span class="p">:</span>
<span class="w">          </span><span class="nt">backup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div>
<ul>
<li>
<p>On the Ansible node (using MTputty via SSH), run <strong>“get_config.yml”</strong> playbook and verify the backup configurations in <strong>“backup”</strong> folder by using below commands:</p>
<pre><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook get_config.yml
[root@rhel7-tools EVPN-Ansible]# ls -lrt
[root@rhel7-tools EVPN-Ansible]# ls backup
</code></pre>
<p>You may further view the contents of the files under backup folder by using cat, less or more commands.  Below screenshot shows the output of above commands</p>
<p><img alt="" src="../pic/5-1-1.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-2-verify-underlay-and-overlay">Step 2: Verify underlay and overlay</h3>
<p>In this step, you will verify underlay and overlay operation using ansible playbook. The playbook will be applied to all leaf switches to verify the below commands:</p>
<p><strong><em>Underlay</em></strong></p>
<pre><code>-   show ip ospf neighbor
-   show ip bgp sum
-   show ip pim neighbor
</code></pre>
<p><strong><em>Overlay</em></strong></p>
<pre><code>-   show nve vni
-   show nve peer
-   show ip route vrf Tenant-1
-   show bgp l2vpn evpn
-   show l2route evpn mac-ip all
</code></pre>
<ul>
<li>Switch to “Atom”, <strong>right click</strong> on the folder <code>EVPN-Ansible</code> and create a new playbook named <code>verify_fabric.yml</code>. Enter this file name and hit enter.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leaf, jinja2_leaf</span>
<span class="w">    </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">    </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">verify underlay</span>
<span class="w">        </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">underlay_output</span>
<span class="w">        </span><span class="nt">cisco.nxos.nxos_command</span><span class="p">:</span>
<span class="w">          </span><span class="nt">commands</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show ip ospf neighbors</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show ip bgp sum</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show ip pim neighbor</span>
<span class="w">        </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">underlay</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var=underlay_output.stdout_lines</span>
<span class="w">        </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">underlay</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify Overlay</span>
<span class="w">        </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay_output</span>
<span class="w">        </span><span class="nt">cisco.nxos.nxos_command</span><span class="p">:</span>
<span class="w">          </span><span class="nt">commands</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show nve vni</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show nve peer</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show ip route vrf Tenant-1</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show bgp l2vpn evpn</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">show l2route evpn mac-ip all</span>
<span class="w">        </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">var=overlay_output.stdout_lines</span>
<span class="w">        </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlay</span>
</code></pre></div>
<ul>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</p>
</li>
<li>
<p>On the Ansible node (via MTPutty), run <strong>verify_fabric.yml</strong> playbook and verify the output for <strong>underlay</strong> by executing below command (using respective tag):
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook verify_fabric.yml --tags &quot;underlay&quot;
</code></pre></div></p>
</li>
</ul>
<hr />
<p><font style=background-color:yellow>The output shows ospf, bgp and pim neighbors for all leaf switches</font></p>
<hr />
<ul>
<li>
<p>Below screenshot shows the partial output of above command:</p>
<p><img alt="" src="../pic/5-2-1.png" /></p>
</li>
</ul>
<p>Here is a log of execution of above command:</p>
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook verify_fabric.yml --tags &quot;underlay&quot;

PLAY [leaf, jinja2_leaf] *********************************************************************************************************************************************************************************************

TASK [verify underlay] ***********************************************************************************************************************************************************************************************
ok: [198.18.4.101]
ok: [198.18.4.104]
ok: [198.18.4.103]

TASK [debug] *********************************************************************************************************************************************************************************************************
ok: [198.18.4.101] =&gt; {
    &quot;underlay_output.stdout_lines&quot;: [
        [
            &quot;OSPF Process ID 1 VRF default&quot;,
            &quot; Total number of neighbors: 2&quot;,
            &quot; Neighbor ID     Pri State            Up Time  Address         Interface&quot;,
            &quot; 192.168.0.6       1 FULL/ -          01:27:12 10.0.0.21       Eth1/1 &quot;,
            &quot; 192.168.0.7       1 FULL/ -          01:27:12 10.0.128.5      Eth1/2&quot;
        ],
        [
            &quot;BGP summary information for VRF default, address family IPv4 Unicast&quot;,
            &quot;BGP router identifier 192.168.0.8, local AS number 65000&quot;,
            &quot;BGP table version is 6, IPv4 Unicast config peers 2, capable peers 2&quot;,
            &quot;0 network entries and 0 paths using 0 bytes of memory&quot;,
            &quot;BGP attribute entries [0/0], BGP AS path entries [0/0]&quot;,
            &quot;BGP community entries [0/0], BGP clusterlist entries [4/16]&quot;,
            &quot;&quot;,
            &quot;Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd&quot;,
            &quot;192.168.0.6     4 65000     161     106        6    0    0 01:23:17 0         &quot;,
            &quot;192.168.0.7     4 65000     161     106        6    0    0 01:23:15 0&quot;
        ],
        [
            &quot;PIM Neighbor Status for VRF \&quot;default\&quot;&quot;,
            &quot;Neighbor        Interface            Uptime    Expires   DR       Bidir-  BFD    ECMP Redirect&quot;,
            &quot;                                                         Priority Capable State     Capable&quot;,
            &quot;10.0.0.21       Ethernet1/1          01:23:08  00:01:35  1        yes     n/a     no&quot;,
            &quot;10.0.128.5      Ethernet1/2          01:23:07  00:01:31  1        yes     n/a     no&quot;
        ]
    ]
}
ok: [198.18.4.104] =&gt; {
    &quot;underlay_output.stdout_lines&quot;: [
        [
            &quot;OSPF Process ID 1 VRF default&quot;,
            &quot; Total number of neighbors: 2&quot;,
            &quot; Neighbor ID     Pri State            Up Time  Address         Interface&quot;,
            &quot; 192.168.0.6       1 FULL/ -          1d04h    10.0.128.1      Eth1/1 &quot;,
            &quot; 192.168.0.7       1 FULL/ -          1d04h    10.0.128.17     Eth1/2&quot;
        ],
        [
            &quot;BGP summary information for VRF default, address family IPv4 Unicast&quot;,
            &quot;BGP router identifier 192.168.0.11, local AS number 65000&quot;,
            &quot;BGP table version is 5, IPv4 Unicast config peers 2, capable peers 2&quot;,
            &quot;0 network entries and 0 paths using 0 bytes of memory&quot;,
            &quot;BGP attribute entries [0/0], BGP AS path entries [0/0]&quot;,
            &quot;BGP community entries [0/0], BGP clusterlist entries [4/16]&quot;,
            &quot;&quot;,
            &quot;Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd&quot;,
            &quot;192.168.0.6     4 65000     672     662        5    0    0 07:03:12 0         &quot;,
            &quot;192.168.0.7     4 65000    1441    1433        5    0    0 22:36:01 0&quot;
        ],
        [
            &quot;PIM Neighbor Status for VRF \&quot;default\&quot;&quot;,
            &quot;Neighbor        Interface            Uptime    Expires   DR       Bidir-  BFD    ECMP Redirect&quot;,
            &quot;                                                         Priority Capable State     Capable&quot;,
            &quot;10.0.128.1      Ethernet1/1          08:51:43  00:01:28  1        yes     n/a     no&quot;,
            &quot;10.0.128.17     Ethernet1/2          22:36:23  00:01:23  1        yes     n/a     no&quot;
        ]
    ]
}
ok: [198.18.4.103] =&gt; {
    &quot;underlay_output.stdout_lines&quot;: [
        [
            &quot;OSPF Process ID 1 VRF default&quot;,
            &quot; Total number of neighbors: 2&quot;,
            &quot; Neighbor ID     Pri State            Up Time  Address         Interface&quot;,
            &quot; 192.168.0.6       1 FULL/ -          01:27:11 10.0.0.29       Eth1/1 &quot;,
            &quot; 192.168.0.7       1 FULL/ -          01:27:10 10.0.128.13     Eth1/2&quot;
        ],
        [
            &quot;BGP summary information for VRF default, address family IPv4 Unicast&quot;,
            &quot;BGP router identifier 192.168.0.10, local AS number 65000&quot;,
            &quot;BGP table version is 6, IPv4 Unicast config peers 2, capable peers 2&quot;,
            &quot;0 network entries and 0 paths using 0 bytes of memory&quot;,
            &quot;BGP attribute entries [0/0], BGP AS path entries [0/0]&quot;,
            &quot;BGP community entries [0/0], BGP clusterlist entries [4/16]&quot;,
            &quot;&quot;,
            &quot;Neighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd&quot;,
            &quot;192.168.0.6     4 65000     148     107        6    0    0 01:23:17 0         &quot;,
            &quot;192.168.0.7     4 65000     150     107        6    0    0 01:23:17 0&quot;
        ],
        [
            &quot;PIM Neighbor Status for VRF \&quot;default\&quot;&quot;,
            &quot;Neighbor        Interface            Uptime    Expires   DR       Bidir-  BFD    ECMP Redirect&quot;,
            &quot;                                                         Priority Capable State     Capable&quot;,
            &quot;10.0.0.29       Ethernet1/1          01:23:09  00:01:37  1        yes     n/a     no&quot;,
            &quot;10.0.128.13     Ethernet1/2          01:23:08  00:01:23  1        yes     n/a     no&quot;
        ]
    ]
}

PLAY RECAP ***********************************************************************************************************************************************************************************************************
198.18.4.101               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
198.18.4.103               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
198.18.4.104               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</code></pre></div>
<p>Next:</p>
<ul>
<li>Run <strong>verify_fabric.yml</strong> playbook and verify the output for <strong>overlay</strong> using the respective tag in the command (as shown below):</li>
</ul>
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook verify_fabric.yml --tags &quot;overlay&quot;
</code></pre></div>
<hr />
<p><font style=background-color:yellow>The output shows nve tunnel peer, host route in bgp EVPN from all leaf switches</font></p>
<hr />
<ul>
<li>
<p>Below screenshot of the partial output of above command:</p>
<p><img alt="" src="../pic/5-2-2.png" /></p>
</li>
<li>
<p>Below shows the complete log output of execution of above playbook command.   Verify the output for <strong>vne vni</strong> status, <strong>vne</strong> dynamic neighbors, type host <strong>mac+ip evpn route update for each L2VNI, l2fib</strong> information.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook verify_fabric.yml --tags &quot;overlay&quot;

PLAY [leaf, jinja2_leaf] *********************************************************************************************************************************************************************************************

TASK [Verify Overlay] ************************************************************************************************************************************************************************************************
ok: [198.18.4.104]
ok: [198.18.4.103]
ok: [198.18.4.101]

TASK [debug] *********************************************************************************************************************************************************************************************************
ok: [198.18.4.104] =&gt; {
    &quot;overlay_output.stdout_lines&quot;: [
        [
            &quot;Codes: CP - Control Plane        DP - Data Plane          &quot;,
            &quot;       UC - Unconfigured         SA - Suppress ARP        &quot;,
            &quot;       SU - Suppress Unknown Unicast&quot;,
            &quot; &quot;,
            &quot;Interface VNI      Multicast-group   State Mode Type [BD/VRF]      Flags&quot;,
            &quot;--------- -------- ----------------- ----- ---- ------------------ -----&quot;,
            &quot;nve1      50140    239.0.0.140       Up    CP   L2 [140]                  &quot;,
            &quot;nve1      50141    239.0.0.141       Up    CP   L2 [141]                  &quot;,
            &quot;nve1      50999    n/a               Up    CP   L3 [Tenant-1]&quot;
        ],
        [
            &quot;Interface Peer-IP          State LearnType Uptime   Router-Mac       &quot;,
            &quot;--------- ---------------  ----- --------- -------- -----------------&quot;,
            &quot;nve1      192.168.0.18     Up    CP        01:07:55 000c.2997.621c   &quot;,
            &quot;nve1      192.168.0.110    Up    CP        01:23:17 000c.2939.f53f&quot;
        ],
        [
            &quot;IP Route Table for VRF \&quot;Tenant-1\&quot;&quot;,
            &quot;&#39;*&#39; denotes best ucast next-hop&quot;,
            &quot;&#39;**&#39; denotes best mcast next-hop&quot;,
            &quot;&#39;[x/y]&#39; denotes [preference/metric]&quot;,
            &quot;&#39;%&lt;string&gt;&#39; in via output denotes VRF &lt;string&gt;&quot;,
            &quot;&quot;,
            &quot;172.21.140.0/24, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.1, Vlan140, [0/0], 22:39:01, direct&quot;,
            &quot;172.21.140.1/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.1, Vlan140, [0/0], 22:39:01, local&quot;,
            &quot;172.21.140.10/32, ubest/mbest: 1/0&quot;,
            &quot;    *via 192.168.0.18%default, [200/0], 01:07:52, bgp-65000, internal, tag 65000 (evpn) segid: 50999 tunnelid: 0xc0a80012 encap: VXLAN&quot;,
            &quot; &quot;,
            &quot;172.21.140.11/32, ubest/mbest: 1/0&quot;,
            &quot;    *via 192.168.0.110%default, [200/0], 01:23:18, bgp-65000, internal, tag 65000 (evpn) segid: 50999 tunnelid: 0xc0a8006e encap: VXLAN&quot;,
            &quot; &quot;,
            &quot;172.21.141.0/24, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.141.1, Vlan141, [0/0], 22:38:59, direct&quot;,
            &quot;172.21.141.1/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.141.1, Vlan141, [0/0], 22:38:59, local&quot;,
            &quot;172.21.141.11/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.141.11, Vlan141, [190/0], 07:04:08, hmm&quot;
        ],
        [
            &quot;BGP routing table information for VRF default, address family L2VPN EVPN&quot;,
            &quot;BGP table version is 458, Local Router ID is 192.168.0.11&quot;,
            &quot;Status: s-suppressed, x-deleted, S-stale, d-dampened, h-history, *-valid, &gt;-best&quot;,
            &quot;Path type: i-internal, e-external, c-confed, l-local, a-aggregate, r-redist, I-injected&quot;,
            &quot;Origin codes: i - IGP, e - EGP, ? - incomplete, | - multipath, &amp; - backup&quot;,
            &quot;&quot;,
            &quot;   Network            Next Hop            Metric     LocPrf     Weight Path&quot;,
            &quot;Route Distinguisher: 192.168.0.8:32907&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;* i                   192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[32]:[172.21.140.10]/272&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;* i                   192.168.0.18                      100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.10:32907&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.110                     100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[32]:[172.21.140.11]/272&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;* i                   192.168.0.110                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.11:32907    (L2VNI 50140)&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[32]:[172.21.140.10]/272&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[32]:[172.21.140.11]/272&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.11:32908    (L2VNI 50141)&quot;,
            &quot;*&gt;l[2]:[0]:[0]:[48]:[000c.2979.f00d]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.111                     100      32768 i&quot;,
            &quot;*&gt;l[2]:[0]:[0]:[48]:[000c.2979.f00d]:[32]:[172.21.141.11]/272&quot;,
            &quot;                      192.168.0.111                     100      32768 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.11:3    (L3VNI 50999)&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[32]:[172.21.140.10]/272&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[32]:[172.21.140.11]/272&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;
        ],
        [
            &quot;Flags -(Rmac):Router MAC (Stt):Static (L):Local (R):Remote (V):vPC link &quot;,
            &quot;(Dup):Duplicate (Spl):Split (Rcv):Recv(D):Del Pending (S):Stale (C):Clear&quot;,
            &quot;(Ps):Peer Sync (Ro):Re-Originated &quot;,
            &quot;Topology    Mac Address    Prod   Flags         Seq No     Host IP         Next-Hops      &quot;,
            &quot;----------- -------------- ------ ---------- --------------- ---------------&quot;,
            &quot;140         0050.56a0.7630 BGP    --            0          172.21.140.10  192.168.0.18   &quot;,
            &quot;140         0050.56a0.b5d1 BGP    --            0          172.21.140.11  192.168.0.110  &quot;,
            &quot;141         000c.2979.f00d HMM    --            0          172.21.141.11  Local&quot;
        ]
    ]
}
ok: [198.18.4.103] =&gt; {
    &quot;overlay_output.stdout_lines&quot;: [
        [
            &quot;Codes: CP - Control Plane        DP - Data Plane          &quot;,
            &quot;       UC - Unconfigured         SA - Suppress ARP        &quot;,
            &quot;       SU - Suppress Unknown Unicast&quot;,
            &quot; &quot;,
            &quot;Interface VNI      Multicast-group   State Mode Type [BD/VRF]      Flags&quot;,
            &quot;--------- -------- ----------------- ----- ---- ------------------ -----&quot;,
            &quot;nve1      50140    239.0.0.140       Up    CP   L2 [140]                  &quot;,
            &quot;nve1      50141    239.0.0.141       Up    CP   L2 [141]                  &quot;,
            &quot;nve1      50999    n/a               Up    CP   L3 [Tenant-1]&quot;
        ],
        [
            &quot;Interface Peer-IP          State LearnType Uptime   Router-Mac       &quot;,
            &quot;--------- ---------------  ----- --------- -------- -----------------&quot;,
            &quot;nve1      192.168.0.18     Up    CP        01:07:55 000c.2997.621c   &quot;,
            &quot;nve1      192.168.0.111    Up    CP        01:23:20 000c.2951.176f&quot;
        ],
        [
            &quot;IP Route Table for VRF \&quot;Tenant-1\&quot;&quot;,
            &quot;&#39;*&#39; denotes best ucast next-hop&quot;,
            &quot;&#39;**&#39; denotes best mcast next-hop&quot;,
            &quot;&#39;[x/y]&#39; denotes [preference/metric]&quot;,
            &quot;&#39;%&lt;string&gt;&#39; in via output denotes VRF &lt;string&gt;&quot;,
            &quot;&quot;,
            &quot;172.21.140.0/24, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.1, Vlan140, [0/0], 01:24:28, direct&quot;,
            &quot;172.21.140.1/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.1, Vlan140, [0/0], 01:24:28, local&quot;,
            &quot;172.21.140.10/32, ubest/mbest: 1/0&quot;,
            &quot;    *via 192.168.0.18%default, [200/0], 01:07:53, bgp-65000, internal, tag 65000 (evpn) segid: 50999 tunnelid: 0xc0a80012 encap: VXLAN&quot;,
            &quot; &quot;,
            &quot;172.21.140.11/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.11, Vlan140, [190/0], 01:23:18, hmm&quot;,
            &quot;172.21.141.0/24, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.141.1, Vlan141, [0/0], 01:24:25, direct&quot;,
            &quot;172.21.141.1/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.141.1, Vlan141, [0/0], 01:24:25, local&quot;,
            &quot;172.21.141.11/32, ubest/mbest: 1/0&quot;,
            &quot;    *via 192.168.0.111%default, [200/0], 01:23:20, bgp-65000, internal, tag 65000 (evpn) segid: 50999 tunnelid: 0xc0a8006f encap: VXLAN&quot;
        ],
        [
            &quot;BGP routing table information for VRF default, address family L2VPN EVPN&quot;,
            &quot;BGP table version is 195, Local Router ID is 192.168.0.10&quot;,
            &quot;Status: s-suppressed, x-deleted, S-stale, d-dampened, h-history, *-valid, &gt;-best&quot;,
            &quot;Path type: i-internal, e-external, c-confed, l-local, a-aggregate, r-redist, I-injected&quot;,
            &quot;Origin codes: i - IGP, e - EGP, ? - incomplete, | - multipath, &amp; - backup&quot;,
            &quot;&quot;,
            &quot;   Network            Next Hop            Metric     LocPrf     Weight Path&quot;,
            &quot;Route Distinguisher: 192.168.0.8:32907&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.18                      100          0 i&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[32]:[172.21.140.10]/272&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.18                      100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.10:32907    (L2VNI 50140)&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;l[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.110                     100      32768 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[32]:[172.21.140.10]/272&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;,
            &quot;*&gt;l[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[32]:[172.21.140.11]/272&quot;,
            &quot;                      192.168.0.110                     100      32768 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.10:32908    (L2VNI 50141)&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[32]:[172.21.141.11]/272&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.11:32908&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.111                     100          0 i&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[32]:[172.21.141.11]/272&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.111                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.10:3    (L3VNI 50999)&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[32]:[172.21.141.11]/272&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.7630]:[32]:[172.21.140.10]/272&quot;,
            &quot;                      192.168.0.18                      100          0 i&quot;
        ],
        [
            &quot;Flags -(Rmac):Router MAC (Stt):Static (L):Local (R):Remote (V):vPC link &quot;,
            &quot;(Dup):Duplicate (Spl):Split (Rcv):Recv(D):Del Pending (S):Stale (C):Clear&quot;,
            &quot;(Ps):Peer Sync (Ro):Re-Originated &quot;,
            &quot;Topology    Mac Address    Prod   Flags         Seq No     Host IP         Next-Hops      &quot;,
            &quot;----------- -------------- ------ ---------- --------------- ---------------&quot;,
            &quot;140         0050.56a0.7630 BGP    --            0          172.21.140.10  192.168.0.18   &quot;,
            &quot;140         0050.56a0.b5d1 HMM    --            0          172.21.140.11  Local          &quot;,
            &quot;141         000c.2979.f00d BGP    --            0          172.21.141.11  192.168.0.111&quot;
        ]
    ]
}
ok: [198.18.4.101] =&gt; {
    &quot;overlay_output.stdout_lines&quot;: [
        [
            &quot;Codes: CP - Control Plane        DP - Data Plane          &quot;,
            &quot;       UC - Unconfigured         SA - Suppress ARP        &quot;,
            &quot;       SU - Suppress Unknown Unicast&quot;,
            &quot; &quot;,
            &quot;Interface VNI      Multicast-group   State Mode Type [BD/VRF]      Flags&quot;,
            &quot;--------- -------- ----------------- ----- ---- ------------------ -----&quot;,
            &quot;nve1      50140    239.0.0.140       Up    CP   L2 [140]                  &quot;,
            &quot;nve1      50141    239.0.0.141       Up    CP   L2 [141]                  &quot;,
            &quot;nve1      50999    n/a               Up    CP   L3 [Tenant-1]&quot;
        ],
        [
            &quot;Interface Peer-IP          State LearnType Uptime   Router-Mac       &quot;,
            &quot;--------- ---------------  ----- --------- -------- -----------------&quot;,
            &quot;nve1      192.168.0.110    Up    CP        01:07:59 000c.2939.f53f   &quot;,
            &quot;nve1      192.168.0.111    Up    CP        01:07:59 000c.2951.176f&quot;
        ],
        [
            &quot;IP Route Table for VRF \&quot;Tenant-1\&quot;&quot;,
            &quot;&#39;*&#39; denotes best ucast next-hop&quot;,
            &quot;&#39;**&#39; denotes best mcast next-hop&quot;,
            &quot;&#39;[x/y]&#39; denotes [preference/metric]&quot;,
            &quot;&#39;%&lt;string&gt;&#39; in via output denotes VRF &lt;string&gt;&quot;,
            &quot;&quot;,
            &quot;172.21.140.0/24, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.1, Vlan140, [0/0], 01:24:29, direct&quot;,
            &quot;172.21.140.1/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.1, Vlan140, [0/0], 01:24:29, local&quot;,
            &quot;172.21.140.10/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.140.10, Vlan140, [190/0], 01:24:18, hmm&quot;,
            &quot;172.21.140.11/32, ubest/mbest: 1/0&quot;,
            &quot;    *via 192.168.0.110%default, [200/0], 01:07:51, bgp-65000, internal, tag 65000 (evpn) segid: 50999 tunnelid: 0xc0a8006e encap: VXLAN&quot;,
            &quot; &quot;,
            &quot;172.21.141.0/24, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.141.1, Vlan141, [0/0], 01:24:25, direct&quot;,
            &quot;172.21.141.1/32, ubest/mbest: 1/0, attached&quot;,
            &quot;    *via 172.21.141.1, Vlan141, [0/0], 01:24:25, local&quot;,
            &quot;172.21.141.11/32, ubest/mbest: 1/0&quot;,
            &quot;    *via 192.168.0.111%default, [200/0], 01:07:51, bgp-65000, internal, tag 65000 (evpn) segid: 50999 tunnelid: 0xc0a8006f encap: VXLAN&quot;
        ],
        [
            &quot;BGP routing table information for VRF default, address family L2VPN EVPN&quot;,
            &quot;BGP table version is 210, Local Router ID is 192.168.0.8&quot;,
            &quot;Status: s-suppressed, x-deleted, S-stale, d-dampened, h-history, *-valid, &gt;-best&quot;,
            &quot;Path type: i-internal, e-external, c-confed, l-local, a-aggregate, r-redist, I-injected&quot;,
            &quot;Origin codes: i - IGP, e - EGP, ? - incomplete, | - multipath, &amp; - backup&quot;,
            &quot;&quot;,
            &quot;   Network            Next Hop            Metric     LocPrf     Weight Path&quot;,
            &quot;Route Distinguisher: 192.168.0.8:32907    (L2VNI 50140)&quot;,
            &quot;*&gt;l[2]:[0]:[0]:[48]:[0050.56a0.7630]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.18                      100      32768 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;*&gt;l[2]:[0]:[0]:[48]:[0050.56a0.7630]:[32]:[172.21.140.10]/272&quot;,
            &quot;                      192.168.0.18                      100      32768 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[32]:[172.21.140.11]/272&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.8:32908    (L2VNI 50141)&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[32]:[172.21.141.11]/272&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.10:32907&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.110                     100          0 i&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[32]:[172.21.140.11]/272&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.110                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.11:32908&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[0]:[0.0.0.0]/216&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;* i                   192.168.0.111                     100          0 i&quot;,
            &quot;* i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[32]:[172.21.141.11]/272&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;*&gt;i                   192.168.0.111                     100          0 i&quot;,
            &quot;&quot;,
            &quot;Route Distinguisher: 192.168.0.8:3    (L3VNI 50999)&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[000c.2979.f00d]:[32]:[172.21.141.11]/272&quot;,
            &quot;                      192.168.0.111                     100          0 i&quot;,
            &quot;*&gt;i[2]:[0]:[0]:[48]:[0050.56a0.b5d1]:[32]:[172.21.140.11]/272&quot;,
            &quot;                      192.168.0.110                     100          0 i&quot;
        ],
        [
            &quot;Flags -(Rmac):Router MAC (Stt):Static (L):Local (R):Remote (V):vPC link &quot;,
            &quot;(Dup):Duplicate (Spl):Split (Rcv):Recv(D):Del Pending (S):Stale (C):Clear&quot;,
            &quot;(Ps):Peer Sync (Ro):Re-Originated &quot;,
            &quot;Topology    Mac Address    Prod   Flags         Seq No     Host IP         Next-Hops      &quot;,
            &quot;----------- -------------- ------ ---------- --------------- ---------------&quot;,
            &quot;140         0050.56a0.7630 HMM    --            0          172.21.140.10  Local          &quot;,
            &quot;140         0050.56a0.b5d1 BGP    --            0          172.21.140.11  192.168.0.110  &quot;,
            &quot;141         000c.2979.f00d BGP    --            0          172.21.141.11  192.168.0.111&quot;
        ]
    ]
}

PLAY RECAP ***********************************************************************************************************************************************************************************************************
198.18.4.101               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
198.18.4.103               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
198.18.4.104               : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

[root@rhel7-tools EVPN-Ansible]#
</code></pre></div>
<hr />
<h3 id="step-3-baseline-configuration-comparison">Step 3: Baseline configuration comparison</h3>
<p>In this section we will compare the running configuration with baseline configuration for configuration compliance check. The configuration file that we backed in tak 1 will be used as baseline configuration.</p>
<p>In this playbook, you will use <strong>“lookup”</strong> module to find the backup filename generated in Step 1. Then you will use <strong>diff_against</strong> function in <strong>nxos_config</strong> module to compare running configuration.</p>
<ul>
<li>On Atom, Open up the project folder <code>EVPN-Ansible</code> and create new file under <strong>“EVPN-Ansible”</strong>. Name the new file <code>verify_config.yml</code> and enter below data in this playbook:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jinja2_leaf,leaf,jinja2_spine,spine</span>
<span class="w">     </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;pipe&#39;,</span><span class="nv"> </span><span class="s">&#39;ls</span><span class="nv"> </span><span class="s">backup/{{</span><span class="nv"> </span><span class="s">inventory_hostname}}_config.*&#39;)}}&quot;</span>
<span class="w">     </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure compliance</span>
<span class="w">         </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">diff_config</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_config</span><span class="p">:</span>
<span class="w">           </span><span class="nt">diff_against</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">intended</span>
<span class="w">           </span><span class="nt">intended_config</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">&#39;{{filename}}&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<ul>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> . This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</p>
</li>
<li>
<p><strong>Before</strong> you run this playbook, <strong>SSH</strong> into <strong>leaf-4</strong> to make some configuration changes by issuing below commands:
<div class="highlight"><pre><span></span><code>config t
no router bgp 65000
copy run start
end
</code></pre></div></p>
</li>
</ul>
<p>Below screenshot shows the output of above command:</p>
<p><img alt="" src="../pic/5-3-0.png" /></p>
<ul>
<li>On the Ansible server (via MTputty SSH session), run the playbook for configuration compliance check by executing <code>ansible-playbook --diff verify_config.yml</code> as shown below below:</li>
</ul>
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook --diff verify_config.yml
</code></pre></div>
<hr />
<p><font style=background-color:yellow>The delta between current running config and base line config are highlighted in <font style=color:limegreen>RED</font> from the result</font></p>
<hr />
<ul>
<li>
<p>Below partial screenshot shows the output of above command:</p>
<p><img alt="" src="../pic/5-3-1.png" /></p>
</li>
<li>
<p>Bring leaf-4 back to the baseline config by executing <code>ansible-playbook jinja2_fabric.yml --limit=198.18.4.104</code> command as shown below:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook jinja2_fabric.yml --limit=198.18.4.104
</code></pre></div>
<ul>
<li>
<p>Below screenshot shows the output of above command.  You can also log into leaf-4 and verify that bgp configurations are back:</p>
<p><img alt="" src="../pic/5-3-2.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-4-add-new-vni">Step 4: Add new VNI</h3>
<p>In this section, we will introduce following new VNI into the VXLAN fabric.</p>
<table>
<thead>
<tr>
<th>VLAN ID</th>
<th>VLAN Name</th>
<th>VNI</th>
<th>IP_Add</th>
<th>mask</th>
<th>Mcast</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>L2-VNI-200-Tenant1</td>
<td>50200</td>
<td>172.21.200.1</td>
<td>24</td>
<td>239.0.0.200</td>
</tr>
<tr>
<td>201</td>
<td>L2-VNI-201-Tenant1</td>
<td>50201</td>
<td>172.21.201.1</td>
<td>24</td>
<td>239.0.0.201</td>
</tr>
</tbody>
</table>
<ul>
<li>First we will creat a new role, and name it <strong>“vni_provision”</strong> under folder roles using <strong>ansible-galaxy</strong> using below commands on the Ansible node (using MTputty via SSH connection):</li>
</ul>
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# cd /root/EVPN-Ansible/roles/
[root@rhel7-tools roles]# ansible-galaxy init vni_provision
</code></pre></div>
<ul>
<li>
<p>Verify vni_provision was created successfully</p>
</li>
<li>
<p>Ansible-galaxy init will create new role with base role structure and empty <strong>main.yml</strong> file as role requires.  </p>
</li>
<li>
<p>Switch to <strong>“Atom”</strong> and sync the new created folders between Ansible node and remote desktop. Right click on project folder <strong>“EVPN-Ansible”</strong>, open <strong>“Remote Sync”</strong> select <strong>“Download Folder”</strong></p>
<p><img alt="" src="../pic/5-4-1.png" /></p>
</li>
<li>
<p>Edit variable file <strong>main.yml</strong> for <strong>“vni_provision”</strong> role under “<strong>/root/EVPN-Ansible/roles/vni_provision/vars</strong>” and enter below data.  Make sure to click <code>File</code> and <code>Save</code> on Atom to push this to Ansible server:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># vars file for vni_provision</span>
<span class="w">  </span><span class="nt">L2VNI</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> vlan_id</span><span class="p">:</span><span class="w"> </span><span class="nv">200</span><span class="p p-Indicator">,</span><span class="nt"> vni</span><span class="p">:</span><span class="w"> </span><span class="nv">50200</span><span class="p p-Indicator">,</span><span class="nt"> ip_add</span><span class="p">:</span><span class="w"> </span><span class="nv">172.21.200.1</span><span class="p p-Indicator">,</span><span class="nt"> mask</span><span class="p">:</span><span class="w"> </span><span class="nv">24</span><span class="p p-Indicator">,</span><span class="nt"> vlan_name</span><span class="p">:</span><span class="w"> </span><span class="nv">L2-VNI-200-Tenant1</span><span class="p p-Indicator">,</span><span class="nt"> mcast</span><span class="p">:</span><span class="w"> </span><span class="nv">239.0.0.200</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> vlan_id</span><span class="p">:</span><span class="w"> </span><span class="nv">201</span><span class="p p-Indicator">,</span><span class="nt"> vni</span><span class="p">:</span><span class="w"> </span><span class="nv">50201</span><span class="p p-Indicator">,</span><span class="nt"> ip_add</span><span class="p">:</span><span class="w"> </span><span class="nv">172.21.201.1</span><span class="p p-Indicator">,</span><span class="nt"> mask</span><span class="p">:</span><span class="w"> </span><span class="nv">24</span><span class="p p-Indicator">,</span><span class="nt"> vlan_name</span><span class="p">:</span><span class="w"> </span><span class="nv">L2-VNI-201-Tenant1</span><span class="p p-Indicator">,</span><span class="nt"> mcast</span><span class="p">:</span><span class="w"> </span><span class="nv">239.0.0.201</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
<p><img alt="" src="../pic/5-4-2.png" /></p>
<ul>
<li>Edit playbook file <strong>main.yml</strong> for <strong>“vni_provision”</strong> role under <strong>“/root/EVPN-Ansible/roles/vni_provision/tasks”</strong> and enter below data.   Make sure to click <code>File</code> and <code>Save</code> on Atom to push this to Ansible server:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="c1"># tasks file for vni_provision</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure VLAN to VNI</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_vlan</span><span class="p">:</span>
<span class="w">           </span><span class="nt">vlan_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">           </span><span class="nt">mapped_vni</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vni</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">           </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vlan_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">         </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">         </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">L2VNI</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure L2VNI</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_interface</span><span class="p">:</span>
<span class="w">           </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vlan&quot;{{ item.vlan_id }}&quot;</span>
<span class="w">         </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">L2VNI</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Assign interface to Tenant VRF</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_vrf_interface</span><span class="p">:</span>
<span class="w">           </span><span class="nt">vrf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tenant-1</span>
<span class="w">           </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vlan{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">         </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">         </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">L2VNI</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure SVI IP</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_l3_interfaces</span><span class="p">:</span>
<span class="w">           </span><span class="nt">config</span><span class="p">:</span>
<span class="w">             </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vlan{{</span><span class="nv"> </span><span class="s">item.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">               </span><span class="nt">ipv4</span><span class="p">:</span>
<span class="w">                 </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.ip_add</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.mask</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">         </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">L2VNI</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure L2VNI SVI</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_interface</span><span class="p">:</span>
<span class="w">           </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vlan&quot;{{ item.vlan_id }}&quot;</span>
<span class="w">           </span><span class="nt">fabric_forwarding_anycast_gateway</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">L2VNI</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure L2VNI to VTEP</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_vxlan_vtep_vni</span><span class="p">:</span>
<span class="w">            </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nve1</span>
<span class="w">            </span><span class="nt">vni</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vni</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">multicast_group</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mcast</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">         </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">L2VNI</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure L2VNI RD/RT</span>
<span class="w">         </span><span class="nt">cisco.nxos.nxos_evpn_vni</span><span class="p">:</span>
<span class="w">          </span><span class="nt">vni</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.vni</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">          </span><span class="nt">route_distinguisher</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<span class="w">          </span><span class="nt">route_target_both</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto</span>
<span class="w">         </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">L2VNI</span><span class="nv"> </span><span class="s">}}&quot;</span>
</code></pre></div>
<p>this is shown in below screenshot:</p>
<p><img alt="" src="../pic/5-4-3.png" /></p>
<ul>
<li>Switch to “Atom”  create new playbook <strong>‘vni_provision.yml’</strong> under project folder <strong>EVPN-Ansible</strong> and enter below data.  Make sure to click <code>File</code> and <code>Save</code> on Atom to push this to Ansible server:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leaf,jinja2_leaf</span>
<span class="w">  </span><span class="nt">connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<span class="w">  </span><span class="nt">roles</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vni_provision</span>
</code></pre></div>
<ul>
<li>Run playbook <strong>vni_provision.yml</strong> to add new VNIs on the fabric by issuing <code>ansible-playbook vni_provision.yml</code> command as shown below:</li>
</ul>
<div class="highlight"><pre><span></span><code>[root@rhel7-tools EVPN-Ansible]# ansible-playbook vni_provision.yml
</code></pre></div>
<p>Below screenshot shows the output of above command:</p>
<p><img alt="" src="../pic/5-4-4.png" /></p>
<ul>
<li>Switch to <strong>MTPutty</strong> and connect to <strong>leaf-4</strong> (SSH connection0, verify the change on leaf switches by issuing below command:
<div class="highlight"><pre><span></span><code>show nve vni
</code></pre></div></li>
</ul>
<p>Notice the new created L2VNI as shown in below screenshot:</p>
<p><img alt="" src="../pic/5-4-5-new.png" /></p>
<h1 id="congratulation-you-have-completed-vxlan-fabric-lab">Congratulation! You have completed VXLAN Fabric Lab.</h1>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.indexes", "navigation.instant", "navigation.top", "search.suggest"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>