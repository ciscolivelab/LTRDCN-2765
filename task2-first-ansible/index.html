
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Task1-ansible-node0/">
      
      
        <link rel="next" href="../task3-vxlan-jinja2-new/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>Task 2 - First Simple Ansible Playbook - Cisco Live 2023 LTRDCN-2765</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-1-using-atom-text-editor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cisco Live 2023 LTRDCN-2765" class="md-header__button md-logo" aria-label="Cisco Live 2023 LTRDCN-2765" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cisco Live 2023 LTRDCN-2765
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task 2 - First Simple Ansible Playbook
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ciscolivelab/LTRDCN-2765" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../intro/" class="md-tabs__link">
        Lab Overview
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Task1-ansible-node0/" class="md-tabs__link md-tabs__link--active">
        Lab Guide
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cisco Live 2023 LTRDCN-2765" class="md-nav__button md-logo" aria-label="Cisco Live 2023 LTRDCN-2765" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cisco Live 2023 LTRDCN-2765
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ciscolivelab/LTRDCN-2765" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="..">Home</a>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Lab Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Lab Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Lab Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Lab Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Task1-ansible-node0/" class="md-nav__link">
        Task 1 - Prepare Ansible node
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Task 2 - First Simple Ansible Playbook
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Task 2 - First Simple Ansible Playbook
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-using-atom-text-editor" class="md-nav__link">
    Step 1: Using "Atom" text Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-lab-folder-on-atom" class="md-nav__link">
    Step 2: Lab folder on Atom
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-define-variables-tasks-for-playbook" class="md-nav__link">
    Step 3: Define variables, tasks for playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-vlan-tasks-in-playbook" class="md-nav__link">
    Step 4: VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-execute-playbook" class="md-nav__link">
    Step 5: Execute playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-server-port-vlan-tasks-in-playbook" class="md-nav__link">
    Step 6: Server port VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-execute-playbook" class="md-nav__link">
    Step 7: Execute playbook
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../task3-vxlan-jinja2-new/" class="md-nav__link">
        Task 3 - Use of Jinja2 templates with Ansible Playbook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../task4-vxlan-nxos/" class="md-nav__link">
        Task 4 - Config switches using Ansible NXOS modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../task5-day2-pipeline0/" class="md-nav__link">
        Task 5 - Day 2 Opertions with CI Pipeline
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-using-atom-text-editor" class="md-nav__link">
    Step 1: Using "Atom" text Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-lab-folder-on-atom" class="md-nav__link">
    Step 2: Lab folder on Atom
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-define-variables-tasks-for-playbook" class="md-nav__link">
    Step 3: Define variables, tasks for playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-vlan-tasks-in-playbook" class="md-nav__link">
    Step 4: VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-execute-playbook" class="md-nav__link">
    Step 5: Execute playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-server-port-vlan-tasks-in-playbook" class="md-nav__link">
    Step 6: Server port VLAN tasks in playbook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-execute-playbook" class="md-nav__link">
    Step 7: Execute playbook
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Task 2 - First Simple Ansible Playbook</h1>

<p>In this section, your will create the first Ansible Playbook for this lab.  This Ansible Playbook will be used to configure VLANs on leaf switches, and to assign VLANs to the server facing port.  Further, you will create and learn about:</p>
<ul>
<li>using variables inside playbook,</li>
<li>loop within Ansible by using “<strong>with_items</strong>”,</li>
<li>logic of using “<strong>when</strong>” and “<strong>tags</strong>” to isolate tasks from whole playbook</li>
</ul>
<hr />
<h3 id="step-1-using-atom-text-editor">Step 1: Using "Atom" text Editor<a class="headerlink" href="#step-1-using-atom-text-editor" title="Permanent link"></a></h3>
<ul>
<li>
<p>Open <strong>“Atom”</strong> text editor by double click the icon on desktop.  Atom is the recommended text editor for this lab:</p>
<p><img alt="" src="../pic/2-1-atom.png" /></p>
</li>
<li>
<p>After opening Atom, you may see a <strong><em>“Register as default atom:// URI handler”</em></strong> message as show in below screenshot.  If this message appears then <strong>Click</strong> the <code>"No, Never"</code> button, else proceed further:</p>
<p><img alt="" src="../pic/2-1-2-atom.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-2-lab-folder-on-atom">Step 2: Lab folder on Atom<a class="headerlink" href="#step-2-lab-folder-on-atom" title="Permanent link"></a></h3>
<p><strong>Atom</strong> provides a <em>Remote sync</em> package that allows to read and push contents to a remote server.  In this case, Atom has been preconfigured to integrate with Ansible node.  As per this integration, Atom Secure copy (SCP) any new files or changes to the Ansible node upon saving.  And Atom also downloads the content from Ansible node as per instructions in this lab.  Atom displays the <strong>EVPN-Ansible</strong> folder that has been downloaded from the ansible server.</p>
<ul>
<li>
<p>After opening <strong>Atom</strong>, there should be a folder in the left pane named: <strong><code>EVPN-Ansible</code></strong></p>
</li>
<li>
<p><strong>Right click</strong> on this pre-configured project folder <code>EVPN-Ansible</code> and <strong>select</strong> <code>New File</code> as shown below:</p>
<p><img alt="" src="../pic/2-2-atom-folder.png" /></p>
</li>
<li>
<p>Name the new file <code>vlan_provision.yml</code> and hit <strong>Enter</strong>.  This will create the new file:</p>
<p><img alt="" src="../pic/2-2-2-atom-vlan.png" /></p>
</li>
<li>
<p>Also, on the lower bar right of the ATOM, verify that Language Mode (grammar) of <strong>YAML</strong> is selected instead of default <strong><code>"Plain Text"</code></strong>.  If <strong><code>"YAML"</code></strong> is not selected, then you should <strong>Select</strong> YAML from the listed options as shown in below screenshot:</p>
<p><img alt="" src="../pic/2-2-3-atom-yaml.png" /></p>
</li>
</ul>
<hr />
<h3 id="step-3-define-variables-tasks-for-playbook">Step 3: Define variables, tasks for playbook<a class="headerlink" href="#step-3-define-variables-tasks-for-playbook" title="Permanent link"></a></h3>
<p>In this step, we are going to create a playbook and define the variable &amp; tasks in the playbook</p>
<ul>
<li>In the <strong>Atom</strong> application, under the <code>vlan_provision.yml</code> file, enter the below content:</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>YAML is space sensitive. Hence be careful with the spaces in below section.  You may copy and paste the full content (start to finish) from below to make sure that spaces are copied properly.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="nn">---</span><span class="w">                     </span>
<span class="c1">#Task 2: Simple playbook assign VLAN to server facing port</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">leaf:jinja2_leaf</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>“<strong>hosts:</strong>” defines the scope of this playbook applies to all switches in group <code>‘leaf’</code> and <code>‘jinja2_leaf’</code> (these were added within the <strong><em>"hosts"</em></strong> file created in pervious task)</li>
<li>You can review the IP addresses of the two “leaf” switches and one “jinja2_leaf” switch in the “<strong><em>hosts</em></strong>” file (configured in previous steps).  For reference, the IP addresses are:<ul>
<li>jinja2_leaf: 198.18.4.104</li>
<li>leaf: 198.18.4.101</li>
<li>leaf: 198.18.4.103</li>
</ul>
</li>
</ul>
</div>
<hr />
<h3 id="step-4-vlan-tasks-in-playbook">Step 4: VLAN tasks in playbook<a class="headerlink" href="#step-4-vlan-tasks-in-playbook" title="Permanent link"></a></h3>
<ul>
<li>In the <strong>Atom</strong>, in the same <code>vlan_provision.yml</code> add below tasks below the previously added content:</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>YAML is space sensitive. Hence be careful with the spaces in below section.  You may copy and paste the full content (start to finish) from below to make sure that spaces are copied properly.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="err">	</span><span class="nt">tasks</span><span class="p">:</span>
<span class="err">	</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provision VLAN</span>
<span class="err">	</span><span class="w">    </span><span class="nt">cisco.nxos.nxos_vlans</span><span class="p">:</span>
<span class="err">	</span><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="err">	</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">vlan_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{item}}&quot;</span>
<span class="err">	</span><span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">active</span>
<span class="err">	</span><span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="err">	</span><span class="w">     </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">140</span>
<span class="err">	</span><span class="w">     </span><span class="p p-Indicator">-</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">141</span>
<span class="err">	</span><span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add vlans</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>This task creates multiple VLANs using <strong>cisco.nxos.nxos_vlans</strong> module</li>
<li>Above only one task is added but multiple tasks can be defined in one playbook under “<strong>tasks</strong>”, each starts with <strong><code>“-“</code></strong></li>
<li>At the end of this play, we use “<strong>tags</strong>” to name the task “<strong>add vlans</strong>”. This is useful to run a specific part of the configuration without running the complete playbook.</li>
</ul>
</div>
<ul>
<li>
<p>Below screenshot shows how playbook will look:</p>
<p><img alt="" src="../pic/2-4-1.png" /></p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Formatting is extremely important when working with Ansible. Ansible playbook would return errors if the spaces are not properly aligned or formatting is not correct.</p>
</div>
<ul>
<li>
<p><strong>Click</strong> <code>File</code> and <code>Save</code> .  This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package.</p>
<p><img alt="" src="../pic/2-4-2.png" /></p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once the Save button is pressed, then at the lower part of ATOM app, you will see message about connecting to Ansible host (198.18.134.150) and saving the vlan_provision.yml file.</p>
</div>
<hr />
<h3 id="step-5-execute-playbook">Step 5: Execute playbook<a class="headerlink" href="#step-5-execute-playbook" title="Permanent link"></a></h3>
<p>After creating the playbook, it is now time to execute the playbook.  Before executing the playbook, we will verify the leaf switch that desired vlan configurations are not present</p>
<ul>
<li>Using the <strong>MTPuTTy</strong> client, <strong>Login</strong> (SSH) to <code>leaf-3</code> switch (or any leaf switch as per <strong>hosts:</strong> variable in the <code>vlan_provision.yml</code> file).  Then execute below command:</li>
</ul>
<div class="highlight"><pre><span></span><code>show vlan brief
</code></pre></div>
<p>This command will show the vlans that currently exist on the leaf switch.  As you note from below screenshot, only the default VLAN (vlan number 1) is configured:</p>
<p><img alt="" src="../pic/2-5-1.png" /></p>
<ul>
<li>
<p>Now, from the <strong>MTPuTTy</strong>, launch a new <strong>ssh</strong> into Ansible node (198.18.134.150)</p>
</li>
<li>
<p>Execute the ansible playbook using below commands under directory <code>EVPN-Ansible</code> :</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>cd ~/EVPN-Ansible
ansible-playbook vlan_provision.yml --tags &quot;add vlans&quot;
</code></pre></div>
<p><strong>Note:</strong> You can ignore the <code>[WARNING]</code> messages for <code>ansible-pylibssh</code> and <code>timeout for nxos_facts</code>.
<strong>Note:</strong> You can ignore the <code>timeout for nxos_facts</code> message.
The below screenshot shows the execution of the playbook:</p>
<p><img alt="" src="../pic/2-5-2b.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the playbook fails first time, re-run the playbook again. Make sure to save all the changes in the playbook first before executing the playbook in Ansible.</p>
</div>
<ul>
<li>After playbook is run successfully, go back to <strong>MTPuTTy</strong> and login via <strong>SSH</strong> into <code>leaf 3</code> again (or the other switch that you logged in earlier in this step) and <strong>check</strong> if vlan 140 and vlan 141 appears by executing below command again:</li>
</ul>
<div class="highlight"><pre><span></span><code>show vlan brief
</code></pre></div>
<p>Below screenshot shows the execution of above command in the switch:</p>
<p><img alt="" src="../pic/2-5-3.png" /></p>
<hr />
<h3 id="step-6-server-port-vlan-tasks-in-playbook">Step 6: Server port VLAN tasks in playbook<a class="headerlink" href="#step-6-server-port-vlan-tasks-in-playbook" title="Permanent link"></a></h3>
<p>We have just tested our first playbook with basic configuration (i.e, by adding 2 VLANs).  Now we are going to add more tasks in the same/existing playbook <strong><code>vlan_provision.yml</code></strong> in this step:</p>
<ul>
<li>
<p>Lets add new <em>tasks</em> in the Ansible playbook to assign VLANs to server facing port.  We will configure VLAN towards the server facing ports</p>
</li>
<li>
<p>Go back to <strong>ATOM</strong> and <strong>add</strong> the following tasks to the <strong>existing playbook</strong></p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>YAML is space sensitive. Hence be careful with the spaces in below section.  You may copy and paste the full content (start to finish) from below to make sure that spaces are copied properly.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="err">	</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure server facing port to L2</span>
<span class="err">	</span><span class="w">    </span><span class="nt">cisco.nxos.nxos_interfaces</span><span class="p">:</span>
<span class="err">	</span><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="err">	</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eth1/3</span>
<span class="err">	</span><span class="w">          </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">layer2</span>
<span class="err">	</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure VLAN for server port</span>
<span class="err">	</span><span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(&quot;101&quot; in inventory_hostname) or (&quot;103&quot; in inventory_hostname)</span>
<span class="err">	</span><span class="w">    </span><span class="nt">cisco.nxos.nxos_l2_interfaces</span><span class="p">:</span>
<span class="err">	</span><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="err">	</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eth1/3</span>
<span class="err">	</span><span class="w">          </span><span class="nt">access</span><span class="p">:</span>
<span class="err">	</span><span class="w">            </span><span class="nt">vlan</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">140</span>
<span class="err">	</span><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overridden</span>
<span class="err">	</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure VLAN for server port</span>
<span class="err">	</span><span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(&quot;102&quot; in inventory_hostname) or (&quot;104&quot; in inventory_hostname)</span>
<span class="err">	</span><span class="w">    </span><span class="nt">cisco.nxos.nxos_l2_interfaces</span><span class="p">:</span>
<span class="err">	</span><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="err">	</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eth1/3</span>
<span class="err">	</span><span class="w">          </span><span class="nt">access</span><span class="p">:</span>
<span class="err">	</span><span class="w">            </span><span class="nt">vlan</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">141</span>
<span class="err">	</span><span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overridden</span>
</code></pre></div>
<ul>
<li><strong>Click</strong> <code>File</code> and <code>Save</code> on ATOM.  This will save the playbook, and also ftp the playbook to Ansible server using pre-configured “<strong>remote-sync</strong>” package</li>
</ul>
<p>In this new play, we used nxos module “<strong>cisco.nxos.nxos_interfaces</strong>” and “<strong>cisco.nxos.nxos_l2_interfaces</strong>”:</p>
<ul>
<li>“<strong>cisco.nxos.nxos_interfaces</strong>” provides the capability to manage the physical attributes of an interface.  In this example, it is used to configure “layer 2” on interface Ethernet &#8531;</li>
<li>“<strong>cisco.nxos.nxos_l2_interfaces</strong>” provides the capability to manage the Layer 2 switchport attributes.  In this example, it is used to configure access mode on Ethernet ports &#8531;</li>
<li>We used “<strong>when</strong>” argument to provide little logic of looking at the IP addresses (as per <strong>hosts</strong> i.e., inventory file) to the play and then appropriately assign VLANs to those hosts.  In our example, the playbook assigned:<ul>
<li>VLAN 140 on leaf-1 and leaf-3 switches (by matching <code>101</code> and <code>103</code> in the <code>hosts</code> file)</li>
<li>VLAN 141 on leaf-4 switch (by matching <code>104</code> in the <code>hosts</code> file)</li>
</ul>
</li>
</ul>
<hr />
<h3 id="step-7-execute-playbook">Step 7: Execute playbook<a class="headerlink" href="#step-7-execute-playbook" title="Permanent link"></a></h3>
<p>Now, we are going to execute this playbook:</p>
<ul>
<li>Before executing the ansible playbook, log into switch (<strong>leaf1</strong>, <strong>leaf3</strong> or <strong>leaf4</strong>) using <strong>MTPuTTy</strong> client.  And check the existing configuration by executing the below command.  In this lab, the default configuration of Leaf-1 and Leaf-3 Ethernet &#8531; ports are configured as trunks.  While Ethernet &#8531; port of Leaf-4 has "no switchport" configured.</li>
</ul>
<div class="highlight"><pre><span></span><code>show run interface ethernet1/3
</code></pre></div>
<ul>
<li>
<p>On <strong>MTPuTTy</strong>, log back into (or launch a new ssh) into “Ansible” node</p>
</li>
<li>
<p>Execute below command to run the Ansible playbook in the <code>EVPN-Ansible</code> directory:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>cd ~/EVPN-Ansible
ansible-playbook vlan_provision.yml
</code></pre></div>
<p>Below screeenshot shows the execution of above playbook:</p>
<p><strong>Note:</strong> You can ignore the <code>[WARNING]</code> messages for <code>ansible-pylibssh</code> and <code>timeout for nxos_facts</code>.
<strong>Note:</strong> You can ignore the <code>timeout for nxos_facts</code> message.
<img alt="" src="../pic/2-7-1-new-b.png" /></p>
<ul>
<li>After we push the configuration, <strong>login</strong> to the <strong>leaf-1</strong> or <strong>leaf-3</strong> switch, and confirm if the server facing port has the access vlan 140 configured with the below command:</li>
</ul>
<div class="highlight"><pre><span></span><code>show run interface ethernet1/3
</code></pre></div>
<p>The output of above command on leaf-3 is shown in below screenshot:</p>
<p><img alt="" src="../pic/2-7-2.png" /></p>
<p>The output of above command on leaf-4 confirms that vlan 141 has been configured as shown in below screenshot:</p>
<p><img alt="" src="../pic/2-7-3.png" /></p>
<hr />
<p><strong>Congratulation! You have created your first ansible playbook, automatically provisioned new VLANs and assigned port to new created VLANs using Ansible. Next we are going to create VXLAN Fabric using Ansible.</strong></p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "navigation.instant", "navigation.indexes", "toc.follow", "content.tabs.link", "search.share", "search.highlight", "search.suggest", "content.code.copy", "content.code.annotations"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>